<h1>CONGRATS!!!!</h1>

<h1 class="tittleStart"><%= challenge.challengeName%></h1>
<div>
    <p>
        <a class="buttonOwnerList" href="/home">
            <button class="iconOwner">HOME</button>
        </a>    
    </p>

    <p class="textStart"><%= challenge.description.substr(0,50) + " ..."%></p>
</div>

<div id="player"></div>

<script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="https://apis.google.com/js/client.js?onload=init"></script>
<script type="text/javascript">
      var challenge = <%- JSON.stringify(challenge); %>

      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      function onYouTubeIframeAPIReady() {
        var aux = challenge.linkValidation.lenght;
        var codeYT = challenge.linkValidation.substr( aux - 11, aux);
      }

      var player;
        player = new YT.Player('player', {
          height: '195',
          width: '300',
          videoId: codeYT,
          playerVars: {
              'autoplay': 1,
              'controls': 0,
              'showinfo': 0,
              'end': 120, 
              'loop':1 
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
     
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      var done = false;
      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.PAUSED && !done) {
          window.location.href = `/challenges/${challenge._id/finished}`;
          done = true;
        }else{
            if(event.data == YT.PlayerState.ENDED && !done){
                player.playVideo();
            }
        }
      }
      function stopVideo() {
        player.stopVideo();
      }
    </script>



<!--key = API:KEY  AIzaSyCDAQHlbvibVgA56XKZIFs45Iue0h5GOqc    -->